<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AR Solar System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script>
        AFRAME.registerComponent('soundhandler', {
            init: function () {
                this.soundEl = document.querySelector('[sound]');
                this.marker = document.querySelector('a-marker');
                this.visible = false;
                this.lastPlayTime = 0;
                this.playDelay = 1000; // Minimum delay between plays in milliseconds
            },
            tick: function () {
                const currentTime = Date.now();
                
                // Check if marker is visible and enough time has passed since last play
                if (this.marker.object3D.visible && !this.visible && 
                    currentTime - this.lastPlayTime > this.playDelay) {
                    
                    // Fade in the sound
                    const sound = this.soundEl.components.sound;
                    sound.data.volume = 0;
                    sound.playSound();
                    
                    // Gradually increase volume
                    let volume = 0;
                    const fadeInterval = setInterval(() => {
                        volume += 0.1;
                        if (volume >= 0.5) {
                            clearInterval(fadeInterval);
                            volume = 0.5;
                        }
                        sound.data.volume = volume;
                    }, 100);

                    this.lastPlayTime = currentTime;
                    this.visible = true;
                    
                } else if (!this.marker.object3D.visible && this.visible) {
                    // Fade out and stop when marker disappears
                    const sound = this.soundEl.components.sound;
                    let volume = sound.data.volume;
                    
                    const fadeInterval = setInterval(() => {
                        volume -= 0.1;
                        if (volume <= 0) {
                            clearInterval(fadeInterval);
                            sound.stopSound();
                        }
                        sound.data.volume = Math.max(0, volume);
                    }, 100);
                    
                    this.visible = false;
                }
            }
        });
    </script>
  </head>
  <body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;>
      <a-assets>
        <a-assets>
            <audio id="space-music" src="audio/Hans Zimmer - S.T.A.Y (Interstellar Main Theme)(slowed reverb).mp3" preload="auto"></audio>
        </a-assets>
      </a-assets>

      <a-marker type="pattern" url="marker/pattern-marker.patt">
        <!-- Sun at the center -->
        <a-entity
          position="0 1 0"
          scale="0.5 0.5 0.5"
          gltf-model="./3d models/sun.glb"
          animation="property: rotation; to: 0 360 0; dur: 20000; easing: linear; loop: true">
        </a-entity>

        <!-- Mercury -->
        <a-entity
          position="0 1 0"
          animation="property: rotation; to: 0 360 0; dur: 15000; easing: linear; loop: true">
          <a-entity
            position="1 0 0"
            scale="0.15 0.15 0.15"
            gltf-model="./3d models/mercury_natural_color.glb"
            animation="property: rotation; to: 0 360 0; dur: 10000; easing: linear; loop: true">
          </a-entity>
        </a-entity>

        <!-- Venus -->
        <a-entity
          position="0 1 0"
          animation="property: rotation; to: 0 360 0; dur: 20000; easing: linear; loop: true">
          <a-entity
            position="1.5 0 0"
            scale="0.2 0.2 0.2"
            gltf-model="./3d models/venus.glb"
            animation="property: rotation; to: 0 360 0; dur: 12000; easing: linear; loop: true">
          </a-entity>
        </a-entity>

        <!-- Earth -->
        <a-entity
          position="0 1 0"
          animation="property: rotation; to: 0 360 0; dur: 25000; easing: linear; loop: true">
          <a-entity
            position="2 0 0"
            scale="0.2 0.2 0.2"
            gltf-model="./3d models/earth.glb"
            animation="property: rotation; to: 0 360 0; dur: 15000; easing: linear; loop: true">
          </a-entity>
        </a-entity>

        <!-- Jupiter -->
        <a-entity
          position="0 1 0"
          animation="property: rotation; to: 0 360 0; dur: 35000; easing: linear; loop: true">
          <a-entity
            position="3 0 0"
            scale="0.4 0.4 0.4"
            gltf-model="./3d models/jupiter.glb"
            animation="property: rotation; to: 0 360 0; dur: 18000; easing: linear; loop: true">
          </a-entity>
        </a-entity>

        <!-- Background Music -->
        <a-entity sound="src: #space-music; autoplay: true; loop: true; volume: 0.5"></a-entity>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>